---
title: "5. Contingency Analysis:  Extending the binomial to more categories"
author: "jsg"
date: "10/21/2020"
output: github_document
---
Before doing this, review the **Contingency Analysis** lecture set slides from 
https://sites.google.com/view/biostats/bioenv-2100/contingency-analysis and
the  **5_beyond_binomial.R** script in the lecture_files folder of the
[CUNY-BioStats github repository](https://github.com/jsgosnell/CUNY-BioStats).

Remember you should

* add code chunks by clicking the *Insert Chunk* button on the toolbar or by
pressing *Ctrl+Alt+I* to answer the questions!
* **knit** your file to produce a markdown version that you can see!
* save your work often 
  * **commit** it via git!
  * **push** updates to github

## Heart attacks 

1. Let’s look at some heart attack data.  Read in the data using
```{r}
heart_attacks <- read.table("http://statland.org/R/R/heartatk4R.txt",header=T)
```
Every entry is a person that has suffered a heart attack. More information on the dataset can be found at

http://statland.org/Software_Help/DataDesk/datafile.htm 

We want to again test if heart attacks occur equally across genders.
```{r}
table(heart_attacks$SEX)
binom.test(7779, 7779+5065)
```
*If I assume males compose 50% of the population, I can test the null hypothesis that 
50% of heart attacks occur in males using a binom.test to conduct a binomial test.
I used the table command 
to determine the number of heart attacks in males and
females and then used binom.test.  The alternative is less than or greater than 50% of
hear attacks occur in males. With a p-value of <.001, I reject the null hypothesis.
Data suggest that males are more likely to have heart attacks. Note this is better than* 
```{r}
chisq.test(table(heart_attacks$SEX), p=c(.50, .50))
```
*which is an approximate test*.

* What if we know that males actually make up 50.8% of the population?

```{r}
table(heart_attacks$SEX)
binom.test(7779, 7779+5065, .508)
```
*Note I can amend the test proportion as noted here.  Results do not change.*

2. Still using the heart attack data, is survival independent of gender?
```{r}
#note what this does
table(heart_attacks$SEX, heart_attacks$DIED)
#then feed it to chisq.test (notice order here does not matter for 2x2 table)
chisq.test(table(heart_attacks$SEX, heart_attacks$DIED))
chisq.test(table(heart_attacks$DIED, heart_attacks$SEX))

```
*I used a chi^2^ to consider if survival was independent of sex. Our null 
hypothesis is that survival does not differ based on sex. the alternative is that
it does. I found a
chi^2^~1~=147.76, which corresponds to a p-value of <.001, so i reject the null
hypothesis.*


3. For people that have a heart attack before they turn 30, is survival independent of gender?

```{r}
chisq.test(table(heart_attacks[heart_attacks$AGE < 30, "SEX"], 
                 heart_attacks[heart_attacks$AGE <30, "DIED"]))
#note warning on approximation, so check it
chisq.test(table(heart_attacks[heart_attacks$AGE < 30, "SEX"], 
                 heart_attacks[heart_attacks$AGE <30, "DIED"]))$expected
#several <1, so use fisher.test
fisher.test(table(heart_attacks[heart_attacks$AGE < 30, "SEX"], 
                  heart_attacks[heart_attacks$AGE <30, "DIED"]))
#so if you are young, no difference
```
*I amended the previous question's code to only focus on individuals who were under 
the age of 30 when they suffered a heart. Otherwise the hypotheses remain the same.
I attempted to use a chi^2^ test but was warned the approximation may be incorrect.
Remember that no cells can have expected values of <1 and <20% should have expected
values <5.  Upon checking 2 cells have expected values <1, so I instead used Fisher's Test.  
I found a p-value of 1, thus I fail to reject the null hypothesis.*


## Dolphins

4. Data on dolphin behavior was collected off the coast of Iceland. Data is @

http://www.statsci.org/data/general/dolpacti.txt

Since this is a .txt file, not a .csv, you’ll need to use something like

```{r}
dolphin <- read.table("http://www.statsci.org/data/general/dolpacti.txt", sep="", header = T)
```

More info on data @ 

http://www.statsci.org/data/general/dolpacti.html

Is traveling independent of time of day?  You’ll need to consider
traveling vs not traveling due to different number of groups observed
in each period.  Carry out post-hoc tests if needed.

*I looked at the data and then just made a table manually*

```{r}
dolphin
travel_table <- as.table(matrix(c(6, 28+ 38, 6, 9, 14, 9, 13, 66), nrow = 4, byrow = T))
#Adding in row and column names will make everything easier to read at end.
colnames(travel_table) = c("travel", "not_travel")
rownames(travel_table) = c("morning", "noon", "afternoon", "night")
#now look at it
travel_table
chisq.test(travel_table)
#check outcome given warning
chisq.test(travel_table)$expected
fisher.test(travel_table)
library(rcompanion)
pairwiseNominalIndependence(travel_table, compare = "row", method = "holm")
```
*I tested the null hypothesis that traveling is independent of time of day (compared
 to the alternative hypothesis that it is not, and thus differs aross time periods)
 using chi^2^ test. However, a warning and subsequent check indicated too many 
 cells had low expected values, so I instead used a Fisher's test. A resulting p-value 
 of <.001 led me reject the null hypothesis. Since I was comparing more than two 
 groups, I used a post-hoc test to see which periods were different and found that travel differed between morning and noon, morning and afternoon, and afternoon and night 
(using the p.adj.Fisher column).*
 
 

## Smoking

5. Use data on smoking and exercise from

http://www.r-tutor.com/elementary-statistics/goodness-fit/chi-squared-test-independence

to determine if smoking is independent of exercise. You’ll need to input data manually.  Carry out post-hoc tests if needed.

*I created a table from the data and tested it using a chi^2^ test to determine 
if smoking was independent of exercise (null hypothesis) or differed based on exercise
levels (alternative). However, a warning led me to see the expected cell values were 
too small, so I instead used a Fisher's test.*

```{r}
smoke <- chisq.test(matrix(c(7, 1, 3, #spacing just for visual use
                             87,18,84,
                             12,3,4,
                             9,1,7), nrow = 4, byrow = T))
smoke$expected #too small!
fisher.test(matrix(c(7, 1, 3, #spacing just for visuals
                     87,18,84,
                     12,3,4,
                     9,1,7), nrow = 4, byrow = T))
```
*A p-value of .4138 meant I failed to reject the null hypothesis.*

